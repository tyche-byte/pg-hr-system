<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>퍼피갤러리 HR - 권한 분리 보안 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }

        /* --- 인쇄 최적화 (A4) --- */
        @media print {
            @page { size: A4; margin: 0; }
            .no-print { display: none !important; }
            body { background-color: white !important; margin: 0; padding: 0; }
            #main-scroll { overflow: visible !important; height: auto !important; padding: 0 !important; margin: 0 !important; }
            main { display: block !important; overflow: visible !important; }
            .preview-container { box-shadow: none !important; margin: 0 !important; padding: 0 !important; width: 100% !important; }
            .a4-page {
                margin: 0 !important;
                padding: 20mm !important;
                box-shadow: none !important;
                border: none !important;
                width: 210mm !important;
                min-height: 297mm !important;
                page-break-after: always;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }

        /* --- 화면 표시용 A4 스타일 --- */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 0 auto 30px auto;
            background: white;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            color: black;
            line-height: 1.6;
            font-size: 10.5pt;
            position: relative;
            box-sizing: border-box;
            border: 1px solid #e2e8f0;
        }

        .contract-table { width: 100%; border-collapse: collapse; margin: 10px 0 20px 0; border: 1px solid black; }
        .contract-table th, .contract-table td { border: 1px solid black; padding: 8px 12px; text-align: left; vertical-align: middle; }
        .contract-table th { background-color: #f1f5f9; font-weight: 700; width: 120px; text-align: center; }

        h1.doc-title { font-size: 18pt; font-weight: 700; text-align: center; margin-bottom: 30px; letter-spacing: -0.5px; }
        h2.doc-section { font-size: 11pt; font-weight: 700; margin-top: 25px; margin-bottom: 10px; background-color: #f3f3f3; padding: 5px 10px; border: 1px solid #000; }
        h3.doc-sub { font-size: 10.5pt; font-weight: 700; margin-top: 15px; margin-bottom: 5px; }
        
        p { margin-bottom: 6px; text-align: justify; }
        ol, ul { padding-left: 20px; margin-bottom: 8px; }
        li { margin-bottom: 3px; }

        .check-box { display: inline-block; width: 14px; height: 14px; border: 1px solid black; margin-right: 4px; vertical-align: middle; position: relative; top: -1px; }
        .input-fill { border-bottom: 1px solid black; padding: 0 5px; min-width: 50px; display: inline-block; text-align: center; font-weight: 600; }

        /* UI 구성요소 */
        .sidebar-item-active { background-color: #1e293b; color: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* 잠금 화면 */
        #lock-screen { backdrop-filter: blur(20px); }

        /* 별지 스타일 */
        .attach-box { border: 2px solid #000; padding: 15px; margin-top: 10px; }
        .attach-title { text-align: center; font-size: 13pt; font-weight: bold; margin-bottom: 15px; text-decoration: underline; }
        .attach-section-title { background-color: #eee; padding: 5px; font-weight: bold; border: 1px solid #000; margin-top: 10px; font-size: 10pt; }
        .attach-content { border: 1px solid #000; border-top: none; padding: 8px; line-height: 1.6; font-size: 9.5pt; }

        /* 사이드바 스크롤 허용 */
        aside#editor-sidebar {
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- [1단계 잠금] 시스템 진입 모달 -->
    <div id="entry-lock" class="fixed inset-0 bg-slate-900/95 z-[100] flex items-center justify-center no-print">
        <div class="bg-white p-10 rounded-3xl shadow-2xl w-full max-w-sm text-center space-y-8 fade-in">
            <div class="w-20 h-20 bg-blue-50 text-blue-600 rounded-3xl flex items-center justify-center mx-auto shadow-inner">
                <i data-lucide="unlock" class="w-10 h-10"></i>
            </div>
            <div>
                <h3 class="text-2xl font-bold text-slate-800 tracking-tight">시스템 로그인</h3>
                <p class="text-sm text-slate-400 mt-2">퍼피갤러리 사내 보안을 위해<br>내부 비밀번호를 입력해 주세요.</p>
            </div>
            <div class="space-y-4">
                <input type="password" id="entry-pw-input" onkeyup="if(event.key==='Enter') verifyEntry()" placeholder="••••" class="w-full text-center text-3xl tracking-[0.8em] border-b-4 border-slate-100 py-4 focus:border-blue-500 outline-none transition-all bg-transparent">
                <p id="entry-error" class="text-xs text-red-500 hidden font-bold">비밀번호가 틀렸습니다.</p>
            </div>
            <button onclick="verifyEntry()" class="w-full py-4 text-md font-bold bg-blue-600 text-white rounded-2xl shadow-xl shadow-blue-200 hover:bg-blue-700 active:scale-95 transition-all">접속하기</button>
            <p class="text-[10px] text-slate-300 uppercase tracking-widest font-semibold italic">Employee Entry Access</p>
        </div>
    </div>

    <!-- [2단계 잠금] 대표자 전용 모달 -->
    <div id="rep-lock" class="fixed inset-0 bg-indigo-900/40 z-[110] hidden flex items-center justify-center no-print fade-in" style="backdrop-filter: blur(10px);">
        <div class="bg-white p-10 rounded-3xl shadow-2xl w-full max-w-sm text-center space-y-6">
            <div class="w-16 h-16 bg-indigo-50 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto">
                <i data-lucide="shield-check" class="w-8 h-8"></i>
            </div>
            <div>
                <h3 class="text-xl font-bold text-slate-800">대표자 전용 인증</h3>
                <p class="text-xs text-slate-400 mt-1">계약서 열람 권한이 필요합니다.</p>
            </div>
            <input type="password" id="rep-pw-input" onkeyup="if(event.key==='Enter') verifyRep()" placeholder="••••" class="w-full text-center text-2xl tracking-[1em] border-b-2 border-slate-100 py-3 focus:border-indigo-500 outline-none transition-all">
            <div class="flex gap-2">
                <button onclick="cancelRepAuth()" class="flex-1 py-3 text-sm font-bold text-slate-400 hover:bg-slate-50 rounded-xl transition">취소</button>
                <button onclick="verifyRep()" class="flex-1 py-3 text-sm font-bold bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition">인증</button>
            </div>
            <p id="rep-error" class="text-xs text-red-500 hidden font-bold">권한이 없습니다.</p>
        </div>
    </div>

    <!-- 사이드바 -->
    <nav id="app-sidebar" class="no-print w-72 bg-slate-900 text-slate-400 hidden flex-col border-r border-slate-800">
        <div class="p-8 flex items-center gap-4 border-b border-slate-800">
            <div class="w-12 h-12 bg-indigo-500 rounded-xl flex items-center justify-center text-white shadow-lg shadow-indigo-500/20">
                <i data-lucide="dog" class="w-7 h-7"></i>
            </div>
            <div>
                <h1 class="text-white font-bold text-lg leading-tight">Puppy Gallery</h1>
                <p class="text-[10px] text-slate-500 uppercase tracking-widest font-semibold mt-1">HR Administration</p>
            </div>
        </div>
        
        <div class="flex-1 p-6 space-y-2 overflow-y-auto">
            <button onclick="switchView('dashboard')" id="nav-dashboard" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 sidebar-item-active">
                <i data-lucide="home" class="w-5 h-5"></i>
                <span class="text-sm font-medium">메인 화면</span>
            </button>
            
            <div class="pt-6 pb-2">
                <p class="text-[10px] font-bold text-slate-600 uppercase px-4 tracking-widest">Employee Action</p>
            </div>
            
            <button onclick="startNewContract()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-blue-600/10 text-blue-400 hover:bg-blue-600 hover:text-white transition-all duration-200 shadow-sm">
                <i data-lucide="file-edit" class="w-5 h-5"></i>
                <span class="text-sm font-bold">새 계약서 작성</span>
            </button>

            <div class="pt-6 pb-2">
                <p class="text-[10px] font-bold text-slate-600 uppercase px-4 tracking-widest">Representative only</p>
            </div>
            
            <button onclick="protectedNavigation('list')" id="nav-list" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-indigo-600/10 hover:text-indigo-400 transition-all duration-200">
                <i data-lucide="folder-lock" class="w-5 h-5"></i>
                <span class="text-sm font-medium">계약서 보관함</span>
            </button>
        </div>

        <div class="p-6 border-t border-slate-800 space-y-3 text-xs">
            <button onclick="protectedNavigation('export')" class="w-full flex items-center gap-3 px-4 py-2 hover:text-indigo-400 transition">
                <i data-lucide="download" class="w-4 h-4"></i> 데이터 백업
            </button>
            <button onclick="logoutAll()" class="w-full flex items-center gap-3 px-4 py-2 text-red-400/60 hover:text-red-400 transition">
                <i data-lucide="power" class="w-4 h-4"></i> 로그아웃
            </button>
        </div>
    </nav>

    <!-- 메인 컨텐츠 -->
    <main id="app-main" class="flex-1 hidden flex flex-col overflow-hidden">
        <header class="no-print h-20 bg-white border-b border-slate-200 flex items-center justify-between px-10 shrink-0 z-10 shadow-sm">
            <div>
                <h2 id="view-title" class="text-xl font-bold text-slate-800 tracking-tight">메인 화면</h2>
                <p id="view-desc" class="text-xs text-slate-400 mt-0.5">퍼피갤러리 근로계약 시스템에 접속되었습니다.</p>
            </div>
            <div class="flex items-center gap-4">
                <div id="save-indicator" class="flex items-center gap-2 px-3 py-1.5 bg-emerald-50 text-emerald-600 rounded-full text-[10px] font-bold opacity-0 transition-opacity">
                    내용 저장됨
                </div>
                <button onclick="window.print()" class="bg-slate-900 hover:bg-blue-600 text-white px-5 py-2.5 rounded-xl text-sm font-bold flex items-center gap-2 transition-all duration-200 shadow-lg">
                    <i data-lucide="printer" class="w-4 h-4"></i> 작성 문서 출력하기
                </button>
            </div>
        </header>

        <div id="main-scroll" class="flex-1 overflow-y-auto p-10 bg-[#f8fafc]">
            <!-- 메인 대시보드 View -->
            <div id="view-dashboard" class="fade-in space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 flex flex-col justify-between">
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">신규 작성</p>
                            <h3 class="text-2xl font-bold mt-2 text-slate-800 italic">근로계약서 작성하기</h3>
                            <p class="text-sm text-slate-400 mt-2">새로운 직원의 근로계약서를 실시간으로 작성하고 출력할 수 있습니다.</p>
                        </div>
                        <button onclick="startNewContract()" class="mt-6 w-full py-3 bg-blue-600 text-white rounded-xl font-bold text-sm shadow-lg shadow-blue-100">작성 시작</button>
                    </div>
                    <div id="rep-stat-card" class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200 opacity-50 grayscale transition-all duration-500 relative overflow-hidden group">
                        <div class="absolute inset-0 bg-slate-900/5 flex items-center justify-center opacity-100 group-hover:opacity-0 transition-opacity z-10 pointer-events-none">
                            <span class="bg-white px-4 py-2 rounded-full text-[10px] font-bold shadow-sm flex items-center gap-2"><i data-lucide="lock" class="w-3 h-3"></i> 대표자 전용</span>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">관리자 통계</p>
                            <h3 id="stat-total" class="text-4xl font-bold mt-2 text-slate-800">***</h3>
                            <p class="text-sm text-slate-400 mt-2">현재까지 보관된 전체 계약 데이터 건수</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden relative">
                    <div id="rep-list-overlay" class="absolute inset-0 bg-white/60 backdrop-blur-sm z-10 flex items-center justify-center">
                         <button onclick="protectedNavigation('list')" class="bg-slate-900 text-white px-6 py-2 rounded-full text-xs font-bold flex items-center gap-2"><i data-lucide="key" class="w-3 h-3"></i> 보관함 열기 (대표 인증)</button>
                    </div>
                    <div class="px-8 py-6 border-b border-slate-100">
                        <h3 class="font-bold text-slate-800">최근 업데이트 내역 (대표 전용)</h3>
                    </div>
                    <div id="recent-list" class="h-32"></div>
                </div>
            </div>

            <!-- 보관함 목록 View -->
            <div id="view-list" class="fade-in hidden space-y-6">
                <div class="flex justify-between items-center">
                    <div class="relative w-96">
                        <i data-lucide="search" class="absolute left-4 top-3.5 w-5 h-5 text-slate-400"></i>
                        <input type="text" oninput="filterList(this.value)" placeholder="직원 이름으로 검색..." class="w-full pl-12 pr-6 py-3 bg-white border border-slate-200 rounded-2xl text-sm outline-none focus:ring-4 focus:ring-indigo-500/10 transition-all">
                    </div>
                </div>
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="bg-slate-50/50 text-slate-400 text-[10px] uppercase font-bold tracking-widest">
                                <th class="px-8 py-4">성명</th>
                                <th class="px-8 py-4">직무</th>
                                <th class="px-8 py-4">시작일</th>
                                <th class="px-8 py-4">급여액</th>
                                <th class="px-8 py-4 text-right">옵션</th>
                            </tr>
                        </thead>
                        <tbody id="full-list" class="divide-y divide-slate-100 text-sm"></tbody>
                    </table>
                </div>
            </div>

            <!-- 에디터 View -->
            <div id="view-editor" class="fade-in hidden flex flex-col lg:flex-row gap-10">
                <aside id="editor-sidebar" class="no-print lg:w-96 shrink-0 space-y-6">
                    <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-200 space-y-8">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">직무 선택</label>
                            <div class="flex p-1 bg-slate-100 rounded-2xl">
                                <button onclick="setJob('logistics')" id="job-log" class="flex-1 py-3 rounded-xl text-sm font-bold transition-all duration-200 shadow-sm bg-white text-blue-600">물류/창고</button>
                                <button onclick="setJob('office')" id="job-off" class="flex-1 py-3 rounded-xl text-sm font-bold transition-all duration-200 text-slate-400">사무/운영</button>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest">인적사항</label>
                            <input type="text" id="edit-name" oninput="updateCurrent('emp_name', this.value)" placeholder="성명" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm outline-none transition-all">
                            <input type="text" id="edit-birth" oninput="updateCurrent('emp_birth', this.value)" placeholder="생년월일" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                            <input type="text" id="edit-phone" oninput="updateCurrent('emp_phone', this.value)" placeholder="연락처" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                            <input type="text" id="edit-addr" oninput="updateCurrent('emp_addr', this.value)" placeholder="주소" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                            <input type="text" id="edit-email" oninput="updateCurrent('emp_email', this.value)" placeholder="이메일" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                        </div>

                        <div class="space-y-4">
                            <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest">근로조건</label>
                            <div class="grid grid-cols-2 gap-3">
                                <input type="date" id="edit-date" oninput="updateCurrent('start_date', this.value)" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-xs">
                                <input type="number" id="edit-probation" oninput="updateCurrent('probation', this.value)" placeholder="수습개월" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                            </div>
                            <input type="text" id="edit-salary" oninput="updateCurrent('salary', this.value)" placeholder="월 급여액(세전)" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                        </div>

                        <!-- 추가된 별지 세부 정보 입력란 -->
                        <div class="space-y-4 pt-4 border-t border-slate-100">
                            <label class="block text-[10px] font-bold text-indigo-400 uppercase tracking-widest">별지 세부 정보</label>
                            <div class="space-y-3">
                                <input type="text" id="edit-attach-etc" oninput="updateCurrent('attach_etc', this.value)" placeholder="[별지1] 기타 업무/승인사항" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                                <input type="text" id="edit-attach-storage" oninput="updateCurrent('attach_storage', this.value)" placeholder="자료 저장 위치 / 보고 채널" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                                <input type="text" id="edit-attach-special" oninput="updateCurrent('attach_special', this.value)" placeholder="특이사항 / 제외 범위" class="w-full border border-slate-200 rounded-xl px-4 py-3 text-sm">
                                
                                <div class="bg-slate-50 p-4 rounded-2xl space-y-2">
                                    <span class="text-[10px] text-slate-400 font-bold block mb-1">휴가 신청서 미리보기 정보</span>
                                    <input type="text" id="edit-vacation-date" oninput="updateCurrent('vacation_date', this.value)" placeholder="휴가 일정 (예: 2025-05-01~05-03)" class="w-full border border-slate-200 rounded-lg px-3 py-2 text-xs">
                                    <input type="text" id="edit-vacation-handover" oninput="updateCurrent('vacation_handover', this.value)" placeholder="인수인계 담당자 성명" class="w-full border border-slate-200 rounded-lg px-3 py-2 text-xs">
                                </div>
                            </div>
                        </div>

                        <button onclick="saveAndExit()" class="w-full bg-slate-900 text-white py-4 rounded-2xl text-sm font-bold hover:bg-blue-600 transition-all shadow-xl flex items-center justify-center gap-3">
                            <i data-lucide="save" class="w-5 h-5"></i> 계약 정보 임시 저장
                        </button>
                    </div>
                </aside>
                <div id="contract-render" class="flex-1 overflow-x-auto pb-20"></div>
            </div>
        </div>
    </main>

    <script>
        // --- Core Data & Security ---
        const DB_KEY = 'pg_hr_app_db_v5';
        const ENTRY_AUTH_KEY = 'pg_entry_authorized';
        const REP_AUTH_KEY = 'pg_rep_authorized';
        
        let contracts = JSON.parse(localStorage.getItem(DB_KEY) || '[]');
        let currentContract = null;
        let isEntryAuth = sessionStorage.getItem(ENTRY_AUTH_KEY) === 'true';
        let isRepAuth = sessionStorage.getItem(REP_AUTH_KEY) === 'true';
        
        let entryPassword = '1111'; 
        let repPassword = '1234';   

        // --- 보안 로직 ---
        function verifyEntry() {
            const input = document.getElementById('entry-pw-input').value;
            if (input === entryPassword || input === repPassword) {
                isEntryAuth = true;
                sessionStorage.setItem(ENTRY_AUTH_KEY, 'true');
                if (input === repPassword) {
                    isRepAuth = true;
                    sessionStorage.setItem(REP_AUTH_KEY, 'true');
                }
                document.getElementById('entry-lock').classList.add('hidden');
                initApp();
            } else {
                document.getElementById('entry-error').classList.remove('hidden');
            }
        }

        function protectedNavigation(targetView) {
            if (isRepAuth) {
                switchView(targetView);
            } else {
                window.pendingRepAction = targetView;
                document.getElementById('rep-lock').classList.remove('hidden');
                document.getElementById('rep-pw-input').focus();
            }
        }

        function verifyRep() {
            const input = document.getElementById('rep-pw-input').value;
            if (input === repPassword) {
                isRepAuth = true;
                sessionStorage.setItem(REP_AUTH_KEY, 'true');
                document.getElementById('rep-lock').classList.add('hidden');
                document.getElementById('rep-error').classList.add('hidden');
                document.getElementById('rep-pw-input').value = '';
                updateRepUI();
                if (window.pendingRepAction) {
                    switchView(window.pendingRepAction);
                    window.pendingRepAction = null;
                }
            } else {
                document.getElementById('rep-error').classList.remove('hidden');
            }
        }

        function cancelRepAuth() {
            document.getElementById('rep-lock').classList.add('hidden');
            document.getElementById('rep-pw-input').value = '';
        }

        function initApp() {
            document.getElementById('app-sidebar').classList.remove('hidden');
            document.getElementById('app-sidebar').classList.add('flex');
            document.getElementById('app-main').classList.remove('hidden');
            document.getElementById('app-main').classList.add('flex');
            updateRepUI();
            renderDashboard();
            lucide.createIcons();
        }

        function updateRepUI() {
            if (isRepAuth) {
                const card = document.getElementById('rep-stat-card');
                if(card) card.classList.remove('opacity-50', 'grayscale');
                const overlay = document.getElementById('rep-list-overlay');
                if(overlay) overlay.classList.add('hidden');
                const total = document.getElementById('stat-total');
                if(total) total.innerText = contracts.length;
            }
        }

        function logoutAll() {
            if (confirm('시스템에서 로그아웃하시겠습니까?')) {
                sessionStorage.clear();
                location.reload();
            }
        }

        // --- Rendering Helpers ---
        const f = (val, def = " [ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ] ") => val || def;
        const formatDate = (dateStr) => {
            if(!dateStr) return "20[ &nbsp;&nbsp; ]년 [ &nbsp;&nbsp; ]월 [ &nbsp;&nbsp; ]일";
            const d = new Date(dateStr);
            return `${d.getFullYear()}년 ${d.getMonth()+1}월 ${d.getDate()}일`;
        };

        function switchView(viewName) {
            ['dashboard', 'list', 'editor'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                const n = document.getElementById(`nav-${v}`);
                if(n) n.classList.remove('sidebar-item-active');
            });
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            const activeNav = document.getElementById(`nav-${viewName}`);
            if(activeNav) activeNav.classList.add('sidebar-item-active');

            const titleMap = { 'dashboard': '메인 화면', 'list': '계약서 보관함', 'editor': '계약서 편집기' };
            document.getElementById('view-title').innerText = titleMap[viewName];

            if(viewName === 'dashboard') renderDashboard();
            if(viewName === 'list') renderList();
            lucide.createIcons();
        }

        function startNewContract() {
            currentContract = { 
                id: Date.now(), jobType: 'logistics', 
                emp_name: '', emp_birth: '', emp_phone: '', emp_addr: '', emp_email: '', 
                start_date: '', probation: '3', salary: '', 
                attach_etc: '', attach_storage: '', attach_special: '',
                vacation_date: '', vacation_handover: '',
                updatedAt: new Date().toISOString() 
            };
            switchView('editor');
            syncEditorFields();
            renderEditor();
        }

        function editContract(id) {
            if(!isRepAuth) { protectedNavigation('list'); return; }
            currentContract = contracts.find(c => c.id === id);
            switchView('editor');
            syncEditorFields();
            renderEditor();
        }

        function syncEditorFields() {
            const c = currentContract;
            document.getElementById('edit-name').value = c.emp_name;
            document.getElementById('edit-birth').value = c.emp_birth;
            document.getElementById('edit-phone').value = c.emp_phone;
            document.getElementById('edit-addr').value = c.emp_addr;
            document.getElementById('edit-email').value = c.emp_email;
            document.getElementById('edit-date').value = c.start_date;
            document.getElementById('edit-salary').value = c.salary;
            document.getElementById('edit-probation').value = c.probation;
            document.getElementById('edit-attach-etc').value = c.attach_etc || '';
            document.getElementById('edit-attach-storage').value = c.attach_storage || '';
            document.getElementById('edit-attach-special').value = c.attach_special || '';
            document.getElementById('edit-vacation-date').value = c.vacation_date || '';
            document.getElementById('edit-vacation-handover').value = c.vacation_handover || '';
            setJob(c.jobType);
        }

        function updateCurrent(key, value) {
            currentContract[key] = value;
            currentContract.updatedAt = new Date().toISOString();
            renderEditor();
            const idx = contracts.findIndex(c => c.id === currentContract.id);
            if(idx > -1) contracts[idx] = currentContract;
            else contracts.unshift(currentContract);
            localStorage.setItem(DB_KEY, JSON.stringify(contracts));
        }

        function setJob(type) {
            currentContract.jobType = type;
            const logBtn = document.getElementById('job-log');
            const offBtn = document.getElementById('job-off');
            logBtn.className = type === 'logistics' ? "flex-1 py-3 rounded-xl text-sm font-bold bg-white text-blue-600 shadow-sm" : "flex-1 py-3 rounded-xl text-sm font-bold text-slate-400";
            offBtn.className = type === 'office' ? "flex-1 py-3 rounded-xl text-sm font-bold bg-white text-blue-600 shadow-sm" : "flex-1 py-3 rounded-xl text-sm font-bold text-slate-400";
            renderEditor();
        }

        function saveAndExit() { 
            if(isRepAuth) switchView('list'); 
            else { alert('계약 정보가 저장되었습니다. 보관함은 대표자만 확인 가능합니다.'); switchView('dashboard'); }
        }

        function deleteContract(id) {
            if(!isRepAuth) return;
            if(confirm('데이터를 영구 삭제하시겠습니까?')) {
                contracts = contracts.filter(c => c.id !== id);
                localStorage.setItem(DB_KEY, JSON.stringify(contracts));
                renderList();
            }
        }

        function renderDashboard() {
            if(isRepAuth) {
                const total = document.getElementById('stat-total');
                if(total) total.innerText = contracts.length;
            }
            const recent = contracts.slice(0, 5);
            const listEl = document.getElementById('recent-list');
            if(!listEl) return;
            if(!isRepAuth) {
                listEl.innerHTML = '<div class="p-10 text-center text-slate-400 text-sm">인증 후 내용을 확인할 수 있습니다.</div>';
            } else if(recent.length === 0) {
                listEl.innerHTML = '<div class="p-10 text-center text-slate-300 text-sm">작성 이력이 없습니다.</div>';
            } else {
                listEl.innerHTML = recent.map(c => `
                    <div class="flex items-center justify-between p-5 px-8 hover:bg-indigo-50/30 transition-all cursor-pointer group" onclick="editContract(${c.id})">
                        <div class="flex items-center gap-5">
                            <div class="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center text-slate-400 font-bold">${c.emp_name ? c.emp_name[0] : '?'}</div>
                            <div>
                                <p class="text-sm font-bold text-slate-800">${c.emp_name || '미입력'}</p>
                                <p class="text-[10px] text-slate-400 font-semibold uppercase tracking-tighter">${c.jobType === 'logistics' ? '창고·물류' : '사무·운영'}</p>
                            </div>
                        </div>
                        <i data-lucide="chevron-right" class="w-4 h-4 text-slate-200 group-hover:text-indigo-400"></i>
                    </div>
                `).join('');
            }
            lucide.createIcons();
        }

        function renderList(filtered = null) {
            if(!isRepAuth) return;
            const data = filtered || contracts;
            const el = document.getElementById('full-list');
            if(!el) return;
            if(data.length === 0) { el.innerHTML = '<tr><td colspan="5" class="p-32 text-center text-slate-300 text-sm">데이터가 없습니다.</td></tr>'; }
            else {
                el.innerHTML = data.map(c => `
                    <tr class="hover:bg-slate-50/50 transition">
                        <td class="px-8 py-5"><div class="flex items-center gap-3"><span class="w-8 h-8 rounded-lg bg-indigo-50 text-indigo-500 flex items-center justify-center font-bold text-xs">${c.emp_name ? c.emp_name[0] : '?'}</span><span class="font-bold text-slate-800 text-sm">${c.emp_name || '-'}</span></div></td>
                        <td class="px-8 py-5 text-xs text-slate-400 uppercase">${c.jobType === 'logistics' ? '창고·물류' : '사무·운영'}</td>
                        <td class="px-8 py-5 text-xs text-slate-500">${c.start_date || '-'}</td>
                        <td class="px-8 py-5 text-xs font-bold text-indigo-600">${c.salary ? Number(c.salary).toLocaleString() + '원' : '-'}</td>
                        <td class="px-8 py-5 text-right space-x-2"><button onclick="editContract(${c.id})" class="p-2.5 text-slate-400 hover:text-indigo-600"><i data-lucide="edit-3" class="w-4 h-4"></i></button><button onclick="deleteContract(${c.id})" class="p-2.5 text-slate-400 hover:text-red-500"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>
                    </tr>
                `).join('');
            }
            lucide.createIcons();
        }

        function filterList(query) {
            const q = query.toLowerCase();
            const filtered = contracts.filter(c => (c.emp_name||"").toLowerCase().includes(q));
            renderList(filtered);
        }

        // --- 상세 렌더링 시스템 ---
        function renderEditor() {
            const c = currentContract;
            const isLog = c.jobType === 'logistics';
            const name = f(c.emp_name);
            const today = formatDate(new Date());
            const start = formatDate(c.start_date);
            const prob = f(c.probation, '3');
            const sal = c.salary ? Number(c.salary).toLocaleString() : ' [ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ] ';
            
            const content = `
                <!-- 1페이지 -->
                <div class="a4-page">
                    <h1 class="doc-title">[퍼피갤러리] 정규직 근로계약서_${isLog?'창고/물류':'사무/운영 직무'}</h1>
                    <p>(이하 “사업주”라 함) <strong>퍼피갤러리(Puppy Gallery) 대표 노미래</strong>와 (이하 “근로자”라 함) <strong>${name}</strong>은 다음과 같이 근로계약을 체결한다.</p>
                    <h2 class="doc-section">[기본 정보]</h2>
                    <table class="contract-table">
                        <tr><th>회사명</th><td>퍼피갤러리(Puppy Gallery)</td><th>대표자</th><td>노미래</td></tr>
                        <tr><th>사업자번호</th><td>316-43-00130</td><th>연락처</th><td>010-8554-9133</td></tr>
                        <tr><th>사업장 주소</th><td colspan="3">[ 경기도 광주시 오포읍 능평리 131-1 2층 ]</td></tr>
                        <tr><th>근로자 성명</th><td>${name}</td><th>생년월일</th><td>${f(c.emp_birth)}</td></tr>
                        <tr><th>주소</th><td colspan="3">${f(c.emp_addr)}</td></tr>
                        <tr><th>연락처</th><td>${f(c.emp_phone)}</td><th>이메일</th><td>${f(c.emp_email)}</td></tr>
                    </table>
                    <h3 class="doc-sub">제1조 (목적 및 계약기간)</h3>
                    <ol><li>본 계약은 근로조건, 직무수행 등을 정함을 목적으로 한다.</li><li>계약 시작일: <span class="input-fill">${start}</span> 부터 기간의 정함이 없는 근로계약으로 한다.</li></ol>
                    <h3 class="doc-sub">제1조의2 (수습기간/시용기간)</h3>
                    <ol><li>수습기간은 입사일로부터 <strong>${prob}개월</strong>로 하며, 적합성 평가를 진행한다.</li><li>수습기간 중 임금: 월 급여의 90% (최저임금 준수).</li></ol>
                    <h3 class="doc-sub">제2조 (근무장소 및 업무내용)</h3>
                    <ol><li>근무장소: 퍼피갤러리 지정 사업장</li><li>업무내용: <strong>${isLog?'창고·물류 및 재고 운영 직무':'사무·관리 및 운영 직무'}</strong>로서 상세는 별지1에 따른다.</li></ol>
                    <h3 class="doc-sub">제3조 (근로일 및 근로시간)</h3>
                    <ol><li>주 5일 근무, 09:00 ~ 17:00 (1일 7시간, 주 35시간).</li><li>휴게시간: 11:30 ~ 12:30 (60분).</li></ol>
                    <h3 class="doc-sub">제4조 (임금 및 복리후생)</h3>
                    <ol><li>월 급여(세전): <strong>${sal}원</strong>. 지급일: 매월 4일.</li></ol>
                </div>

                <!-- 2페이지 -->
                <div class="a4-page page-break">
                    <h3 class="doc-sub">제5조 (보고·협업 및 연락 의무 – 10-10-10 규칙)</h3>
                    <ol>
                        <li><strong>업무 시작 보고</strong>: 근무 시작 후 10분 이내 ‘일일 업무계획’ 보고.</li>
                        <li><strong>업무 종료 보고</strong>: 근무 종료 후 10분 이내 ‘일일 업무결과’ 보고.</li>
                        <li><strong>응답 의무</strong>: 근무시간 중 회사 연락에 10분 이내 응답 원칙.</li>
                        <li><strong>출고 마감 운영</strong>: 16시 송장마감, 17시 배송마감 준수.</li>
                    </ol>
                    <h3 class="doc-sub">제6조 ~ 제10조 (휴가, 비밀유지, 인수인계 등)</h3>
                    <p>연차/약정휴가 신청 시 최소 1개월 전 신청하며, 비밀유지 및 인수인계 의무를 성실히 이행한다.</p>
                    <div class="signature-section" style="margin-top:150px; border:1px solid #000; padding:20px;">
                        <p style="text-align: center; margin-bottom: 30px"><strong>작성일: ${today}</strong></p>
                        <div class="flex justify-between">
                            <div class="w-1/2"><strong>사업주(회사):</strong> 퍼피갤러리 대표 노미래 (인)<div style="border-bottom: 1px solid #000; margin-top: 30px;"></div></div>
                            <div class="w-1/2 ml-10"><strong>근로자:</strong> ${name} (인)<div style="border-bottom: 1px solid #000; margin-top: 30px;"></div></div>
                        </div>
                    </div>
                </div>

                <!-- 3페이지: 별지1 -->
                <div class="a4-page page-break">
                    <div class="attach-box">
                        <div class="attach-title">[별지1-${isLog?'B':'A'}] 직무기술서/업무범위 체크리스트(${isLog?'창고·물류용':'사무·운영용'})</div>
                        <p>• 근로자: ${name} &nbsp; • 작성일: ${today}</p>
                        
                        <div class="attach-section-title">1) 필수 책임업무(본인 책임)</div>
                        <div class="attach-content">
                            ${isLog ? `
                                <span class="check-box"></span> 입고(검수/수량 확인/적치)<br>
                                <span class="check-box"></span> 출고(피킹/패킹/송장 마감)<br>
                                <span class="check-box"></span> 재고 관리(로케이션/실사 보고)<br>
                                <span class="check-box"></span> 반품/교환 실물 처리 및 기록<br>
                                <span class="check-box"></span> 출고 마감 운영 준수 (15~17 마감)
                            ` : `
                                <span class="check-box"></span> 주문/송장 데이터 관리<br>
                                <span class="check-box"></span> CS 처리(문의/교환/반품)<br>
                                <span class="check-box"></span> 재고/상품 데이터 관리<br>
                                <span class="check-box"></span> 출고 마감 영향 이슈 보고
                            `}
                        </div>

                        <div class="attach-section-title">2) 지원업무(요청 시)</div>
                        <div class="attach-content">
                            ${isLog ? `<span class="check-box"></span> 행사 지원 <br>` : `<span class="check-box"></span> 거래처 응대 <br>`}
                            <span class="check-box"></span> 기타: ${f(c.attach_etc)}
                        </div>

                        <div class="attach-section-title">3) 승인 필요 업무(단독 처리 금지)</div>
                        <div class="attach-content">
                            <span class="check-box"></span> 임의 출고/폐기/반품 <br>
                            <span class="check-box"></span> 재고 조정 및 수량 수정 <br>
                            <span class="check-box"></span> 기타: ${f(c.attach_etc)}
                        </div>

                        <div class="attach-content" style="margin-top: 10px; border-top: 1px solid #000">
                            <p>• 자료 저장 위치/보고 채널: ${f(c.attach_storage)}</p>
                            <p>• 특이사항/제외 범위: ${f(c.attach_special)}</p>
                        </div>
                        <div style="margin-top: 20px; text-align: right">서명: 근로자 [ &nbsp;&nbsp;&nbsp;&nbsp; ] / 사업주 [ &nbsp;&nbsp;&nbsp;&nbsp; ]</div>
                    </div>
                </div>

                <!-- 4페이지: 별지2, 3 -->
                <div class="a4-page page-break">
                    <div class="attach-box">
                        <div class="attach-title">[별지2] 업무보고·회의 운영 양식(공용)</div>
                        <p>• 작성자: ${name} &nbsp; • 작성일: ${today}</p>
                        <div class="attach-section-title">0) 고정 기준</div>
                        <div class="attach-content">시작 보고 10분 내 / 종료 보고 10분 내 / 응답 10분 내</div>
                        <div class="attach-section-title">1) 일일 업무계획(TOP3 및 긴급 이슈)</div>
                        <div class="attach-content" style="min-height:60px">입력된 계획 없음</div>
                        <div class="attach-section-title">2) 일일 업무결과(완료/이월/마감결과)</div>
                        <div class="attach-content" style="min-height:60px">입력된 결과 없음</div>
                    </div>

                    <div class="attach-box" style="margin-top:20px">
                        <div class="attach-title">[별지3] 휴가 신청서</div>
                        <p>• 신청자: ${name} &nbsp; • 작성일: ${today}</p>
                        <div class="attach-section-title">1) 휴가 종류 및 일정</div>
                        <div class="attach-content">
                            일정: ${f(c.vacation_date)}
                        </div>
                        <div class="attach-section-title">2) 마감 영향 및 인수인계(필수)</div>
                        <div class="attach-content">
                            인수인계 담당자: ${f(c.vacation_handover)}
                        </div>
                        <div style="margin-top: 15px; text-align: center">신청자 서명: (인) &nbsp;&nbsp;&nbsp;&nbsp; 관리자 승인: (인)</div>
                    </div>
                </div>
            `;
            document.getElementById('contract-render').innerHTML = content;
        }

        function exportData() {
            if(!isRepAuth) return;
            const blob = new Blob([JSON.stringify(contracts, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `PG_HR_Backup_${new Date().toISOString().slice(0,10)}.json`; a.click();
        }

        window.onload = () => {
            if (isEntryAuth) { document.getElementById('entry-lock').classList.add('hidden'); initApp(); }
            else { document.getElementById('entry-lock').classList.remove('hidden'); lucide.createIcons(); }
        };
    </script>
</body>
</html>
